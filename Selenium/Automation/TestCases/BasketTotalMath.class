package com.saucedemo.TestCases;//Test case no. 4
//happy path do momentu podsumowania zamowienia
//sprawdzenie czy aplikacja dobrze policzyla calkowita kwote do zaplaty (produkty + podatek)

import com.saucedemo.Pages.BasketPage;
import com.saucedemo.Pages.CheckoutStepOnePage;
import com.saucedemo.Pages.InventoryPage;
import com.saucedemo.Pages.LoginPage;
import io.github.bonigarcia.wdm.WebDriverManager;
import org.junit.Assert;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;

public class BasketTotalMath {
    public static WebDriver driver;
    public static void main(String[] args) {
        WebDriverManager.chromedriver().setup();
        driver = new ChromeDriver();

        driver.manage().window().maximize();
        driver.get("https://www.saucedemo.com/index.html");

        LoginPage login = new LoginPage(driver);
        login.loginToWebsite();

        InventoryPage inventory = new InventoryPage(driver);
        inventory.addToBasket();
        inventory.goToBasket();

        BasketPage basket = new BasketPage(driver);
        basket.clickDeleteFirst();
        basket.clickCheckoutButton();

        CheckoutStepOnePage checkoutOne = new CheckoutStepOnePage(driver);
        checkoutOne.setFirstName();
        checkoutOne.setLastName();
        checkoutOne.setPostalCode();
        checkoutOne.clickContinue();

        String ItemTotalText = driver.findElement(By.xpath("//*[@id=\"checkout_summary_container\"]/div/div[2]/div[5]")).getText();
        String ItemTotalShort = ItemTotalText.replace("Item total: $","");
        double itemTotal = Double.parseDouble(ItemTotalShort);
//        System.out.println(itemTotal);

        String TaxText = driver.findElement(By.xpath("//*[@id=\"checkout_summary_container\"]/div/div[2]/div[6]")).getText();
        String TaxShort = TaxText.replace("Tax: $","");
        double tax = Double.parseDouble(TaxShort);
//        System.out.println(tax);

        String TotalText = driver.findElement(By.xpath("//*[@id=\"checkout_summary_container\"]/div/div[2]/div[7]")).getText();
        String TotalShort = TotalText.replace("Total: $","");
        double total = Double.parseDouble(TotalShort);
//        System.out.println(total);

        double totalControl = itemTotal + tax;
//        System.out.println(totalControl);
        Assert.assertEquals(total, totalControl,0.009);
        driver.close();
    }
}
